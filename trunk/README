
djmount
=======

djmount - mount MediaServers content as a Linux filesystem.
Created 23/04/2005, Rémi Turboult <r3mi@users.sourceforge.net>


djmount is a UPnP AV client. It mounts as a Linux filesystem (using FUSE)
the media content of compatible UPnP AV devices (see "Known Compatible Devices"
paragraph below).

djmount discovers automatically all UPnP AV Media Servers on the network,
and make the content available in a directory tree. All shared files 
(e.g. Audio or Video files) are directly visible and can be played using 
your favorite media player.


djmount is free software, licensed under the terms of the GNU General Public
License (GNU GPL : see "COPYING" file) : see details in "Copyright and 
Licenses" paragraph below.


Example
-------

(the actual content listed depends on your AV files collection !)

$ djmount /mnt/av

$ cd /mnt/av

$ ls -l
dr-xr-xr-x  3 root root 512 jan  1  2000 SomeMediaServerDeviceName/
dr-xr-xr-x  3 root root 512 jan  1  2000 AnotherMediaServerDeviceName/
-r--r--r--  1 root root 114 jan  1  2000 devices

$ cd SomeMediaServerDeviceName

$ ls -l 
dr-xr-xr-x  5 root root  512 jan  1  2000 browse/
-r--r--r--  1 root root 1749 jan  1  2000 status

$ ls -l browse/
dr-xr-xr-x  14 root root 512 jan  1  2000 Music/
dr-xr-xr-x   5 root root 512 jan  1  2000 Pictures/
dr-xr-xr-x   4 root root 512 jan  1  2000 Videos/

$ ls -l browse/Music/Artists/Tinariwen/
-r--r--r--  1 root root 5407087 jan  1  2000 Chatma.mp3
-r--r--r--  1 root root     722 jan  1  2000 Chatma.xml
-r--r--r--  1 root root      73 jan  1  2000 Chet Boghassa.mp3
-r--r--r--  1 root root 3751143 jan  1  2000 Chet Boghassa.xml

$ xmms browse/Music/Artists/Tinariwen/

$ fusermount -u /mnt/av


Note: the FUSE  kernel module shall be loaded before running djmount 
(otherwise you will get the error: 
"fusermount: fuse device not found, try 'modprobe fuse' first").


Building and Installation
-------------------------

djmount has been built and tested on the following configurations:

* MandrakeLinux 10.1 (kernel 2.6.8.1-12mdk, gcc 3.4.1, glibc-2.3.3), 
  FUSE 2.4.0

* GeeXboX 0.98.7 (Linux kernel 2.6.14, gcc 3.4.4, uClibc 0.9.28),
  FUSE 2.4.1

* Debian sid (Linux kernel 2.6.14, gcc 4.0.3 20051023 prerelease)



A) Basic build instruction:

1) Prerequisites for compilation:

   * the FUSE package : http://fuse.sourceforge.net/ 

2) Use 'configure' and 'make' in the top directory to compile.
   Example :
	./configure
	make

3) if you want to install djmount on your system, run :
	make install

   or to strip the resulting executable :
	make install-strip


B) Advanced build instruction:

"configure" as a few options to customise djmount: see --help option.
In particular,
	
  --disable-debug             extra debugging code [default=enabled]
  --with-fuse-prefix=DIR      search for fuse in DIR/include and DIR/lib
  --with-libiconv-prefix=DIR  search for libiconv in DIR/include and DIR/lib
  --with-external-talloc      use external talloc library (not recommended)
                              [default = use internal bundled library]
  --with-talloc-prefix=DIR    search for talloc in DIR/include and DIR/lib
  --with-external-libupnp     use external libupnp library (not recommended)
                              [default = use internal bundled library]
  --with-libupnp-prefix=DIR   search for libupnp in DIR/include and DIR/lib

configure with also checks the following environment variables in
case there is a custom installation (see also configure --help):
	FUSE_CFLAGS, FUSE_LIBS, 
	TALLOC_CFLAGS, TALLOC_LIBS, 
	LIBUPNP_CFLAGS, LIBUPNP_LIBS.

Examples:
	./configure --with-external-talloc --with-talloc-prefix=/opt/local
	TALLOC_CFLAGS='-I/opt/include' ./configure --with-external-talloc

Note: djmount requires the patches included in the bundled libupnp library.
However, this library can be built and configured separately:

	cd libupnp
	./configure --enable-debug
	make
	make install
	cd ..
	./configure --with-external-libupnp 
	make


Usage 
-----

1) as root : load the FUSE kernel module

	modprobe fuse

2) To run, simply use the 'djmount' executable
   (no extra file is needed).
   The FUSE mountpoint is a required argument. For example:

	djmount /mnt/upnp

3) when finished, unmount the mountpoint (see details in FUSE documentation):

	fusermount -u /mnt/upnp

4) Options :
   see "djmount --help" for the complete list of options.
   A useful option is "-o" which can set mount options, in particular:
 
   "-o iocharset=<charset>" for proper encoding of filenames, in case djmount 
   has not autodetected your settings (which should be the default).
   Example :
	djmount -o iocharset=iso-8859-15 /mnt/upnp

   "-o playlists" to render all Audio or Video files as playlists (.m3u or 
   .ram), which contains an URL for the file. In this mode, only the address 
   of the file is exported through djmount ; the actual content is streamed 
   through HTTP when the playlist is accessed by your favorite media player.
   This mode was the only mode possible for djmount before version 0.50.


Known Compatible Devices
------------------------

djmount has been tested successfully with the following UPnP AV 
Devices / Media Servers :

* TwonkyVision UPnP Music Server ( http://www.twonkyvision.de )
  versions 2.7.2 and 2.9.1 for Linux are ok

* GMediaServer on Linux ( http://www.nongnu.org/gmediaserver/ )
  versions 0.7.0 and 0.8.2 ok (version 0.8.0 not ok)

* Ahead Nero MediaHome Server ( http://www.nero.com/en/Nero_MediaHome.html )
  included in Nero ultra 6.6

* Microsoft Windows Media Connect 
  ( http://www.microsoft.com/windows/windowsmedia/devices/wmconnect/ )
  requires Windows XP Service Pack 2 (SP2) and .NET FrameWork 1.1. 

* GeeXboX uShare on Linux ( http://ushare.geexbox.org/ )
  version 0.9.1 and 0.9.3


This page describes how to share A/V content with some of the above servers :
 http://www.geexbox.org/wiki/index.php/Accessing_to_UPnP_Contents


Although djmount should work with other UPnP AV compliant devices, 
help is needed to test on additional devices.



Implementation
--------------

This project uses the following main libraries :

* the FUSE package ( http://fuse.sourceforge.net/ ), 

* the Linux SDK for UPnP Devices (libupnp), initially created by Intel:
  http://upnp.sourceforge.net/ .
  "djmount" is bundled with a copy of this library (in the "libupnp" 
  directory), with some mandatory patches.

* the "talloc" library : http://talloc.samba.org/
  "djmount" is bundled with a copy of this library, for convenience.

* for testing only (test_upnp executable) : "readline" library (optionnal)


The UPnP AV Architecture is described here : 
http://www.upnp.org/standardizeddcps/mediaserver.asp


Copyright and Licenses
----------------------

djmount is free software :


* "djmount" is (C) Copyright 2005 Rémi Turboult.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA


* The "libupnp" directory contains the Linux SDK for UPnP Devices :
  Copyright (c) 2000-2003 Intel Corporation

This software is licensed under the terms of a modified BSD license,
compatible with the GNU GPL : see libupnp/LICENSE file.


* The "talloc" library is Copyright (C) Andrew Tridgell 2004-2005

This software is licensed under the terms of the GNU General Public License.


* The source code of this project may contain files from other projects, 
  and files generated by other projects, including:
  - The GNU Portability Library (C) 2004 Free Software Foundation 
    ( http://www.gnu.org/software/gnulib/ )

Such files are licensed under the terms of the GNU General Public License
or a license compatible with the GNU GPL : see each file for copyright.
